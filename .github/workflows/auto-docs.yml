name: Auto-Update Documentation

on:
  push:
    branches: [master]

jobs:
  update-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Gemini CLI
        run: npm install -g @google/gemini-cli
      
      - name: Generate Project Documentation
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          # Create docs directory if it doesn't exist
          mkdir -p docs
          # Let Gemini CLI analyze the codebase and generate general project docs
          gemini "Create comprehensive project documentation in Markdown format. Output only the final documentation, no conversation or explanations of your process.

          Analyze this codebase and create documentation with these sections:
          1. Project Overview and Purpose
          2. Technology Stack and Dependencies  
          3. File Structure Explanation
          4. Build and Deployment Process
          5. Content Management Workflow
          6. Development Setup Instructions
          
          Start directly with a # heading and provide only the markdown documentation." > docs/general.md
      
      - name: Commit updated docs
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add docs/
          git diff --staged --quiet || git commit -m "ðŸ¤– Auto-update project documentation"
          git push
